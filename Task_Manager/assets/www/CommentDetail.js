/*
 * JS for CommentDetail generated by Appery.io
 */

Apperyio.getProjectGUID = function() {
    return 'd3bb6bf8-f3d1-476c-8f01-cd8b36c17e95';
};

function navigateTo(outcome, useAjax) {
    Apperyio.navigateTo(outcome, useAjax);
}

function adjustContentHeight() {
    Apperyio.adjustContentHeightWithPadding();
}

function adjustContentHeightWithPadding(_page) {
    Apperyio.adjustContentHeightWithPadding(_page);
}

function setDetailContent(pageUrl) {
    Apperyio.setDetailContent(pageUrl);
}

Apperyio.AppPages = [{
    "name": "CommentMaster",
    "location": "CommentMaster.html"
}, {
    "name": "CommentDetail",
    "location": "CommentDetail.html"
}];

function CommentDetail_js() {

    /* Object & array with components "name-to-id" mapping */
    var n2id_buf = {
        'showmenue': 'CommentDetail_showmenue',
        'mobileworkarea_10': 'CommentDetail_mobileworkarea_10',
        '_id': 'CommentDetail__id',
        '_id_Layout': 'CommentDetail__id_Layout',
        '_id_leftcell': 'CommentDetail__id_leftcell',
        '_id_FieldName': 'CommentDetail__id_FieldName',
        '_id_rightcell': 'CommentDetail__id_rightcell',
        '_id_FieldValue': 'CommentDetail__id_FieldValue',
        'Message': 'CommentDetail_Message',
        'Message_Layout': 'CommentDetail_Message_Layout',
        'Message_leftcell': 'CommentDetail_Message_leftcell',
        'Message_FieldName': 'CommentDetail_Message_FieldName',
        'Message_rightcell': 'CommentDetail_Message_rightcell',
        'Message_FieldValue': 'CommentDetail_Message_FieldValue',
        'Author': 'CommentDetail_Author',
        'Author_Layout': 'CommentDetail_Author_Layout',
        'Author_leftcell': 'CommentDetail_Author_leftcell',
        'Author_FieldName': 'CommentDetail_Author_FieldName',
        'Author_rightcell': 'CommentDetail_Author_rightcell',
        'Author_FieldValue': 'CommentDetail_Author_FieldValue',
        'actionbuttons': 'CommentDetail_actionbuttons',
        'savebutton': 'CommentDetail_savebutton',
        'cancelbutton': 'CommentDetail_cancelbutton',
        'mobileworkarea_12': 'CommentDetail_mobileworkarea_12',
        'NavigationMenu': 'CommentDetail_NavigationMenu',
        'NavigationComment': 'CommentDetail_NavigationComment',
        'navigateToCommentMaster': 'CommentDetail_navigateToCommentMaster'
    };

    if ("n2id" in window && window.n2id !== undefined) {
        $.extend(n2id, n2id_buf);
    } else {
        window.n2id = n2id_buf;
    }

    /*
     * Nonvisual components
     */

    Apperyio.mappings = Apperyio.mappings || {};

    Apperyio.mappings["CommentDetail_CommentDetail_onpageshow_mapping_0"] = {
        "homeScreen": "CommentDetail",
        "directions": [

        {
            "from_name": "currentComment",
            "from_type": "LOCAL_STORAGE",

            "to_name": "CommentDetail",
            "to_type": "UI",

            "mappings": [

            {

                "source": "$['_id']",
                "target": "$['_id_FieldValue:text']"

            },

            {

                "source": "$['Message']",
                "target": "$['Message_FieldValue:text']"

            },

            {

                "source": "$['Author']",
                "target": "$['Author_FieldValue:text']"

            }

            ]
        }

        ]
    };

    Apperyio.mappings["CommentDetail_savebutton_onclick_mapping_0"] = {
        "homeScreen": "CommentDetail",
        "directions": [

        {
            "from_name": "CommentDetail",
            "from_type": "UI",

            "to_name": "currentComment",
            "to_type": "LOCAL_STORAGE",

            "mappings": [

            {

                "source": "$['_id_FieldValue:text']",
                "target": "$['_id']"

            },

            {

                "source": "$['Message_FieldValue:text']",
                "target": "$['Message']"

            },

            {

                "source": "$['Author_FieldValue:text']",
                "target": "$['Author']"

            }

            ]
        }

        ]
    };

    Apperyio.mappings["CommentDetail_deleteComment_onbeforesend_mapping_0"] = {
        "homeScreen": "CommentDetail",
        "directions": [

        {
            "from_name": "currentComment",
            "from_type": "LOCAL_STORAGE",

            "to_name": "deleteComment",
            "to_type": "SERVICE_REQUEST",

            "to_default": {
                "headers": {
                    "X-Appery-Database-Id": "{database_id}"
                },
                "parameters": {},
                "body": null
            },

            "mappings": [

            {

                "source": "$['_id']",
                "target": "$['parameters']['_id']"

            }

            ]
        }

        ]
    };

    Apperyio.mappings["CommentDetail_createComment_onbeforesend_mapping_0"] = {
        "homeScreen": "CommentDetail",
        "directions": [

        {
            "from_name": "currentComment",
            "from_type": "LOCAL_STORAGE",

            "to_name": "createComment",
            "to_type": "SERVICE_REQUEST",

            "to_default": {
                "headers": {
                    "X-Appery-Database-Id": "{database_id}",
                    "Content-Type": "application/json"
                },
                "parameters": {},
                "body": {
                    "acl": {
                        "*": {
                            "write": true,
                            "read": true
                        }
                    }
                }
            },

            "mappings": [

            {

                "source": "$['Message']",
                "target": "$['body']['Message']"

            },

            {

                "source": "$['Author']",
                "target": "$['body']['Author']"

            }

            ]
        }

        ]
    };

    Apperyio.mappings["CommentDetail_queryComment_onbeforesend_mapping_0"] = {
        "homeScreen": "CommentDetail",
        "directions": [

        {

            "to_name": "queryComment",
            "to_type": "SERVICE_REQUEST",

            "to_default": {
                "headers": {
                    "X-Appery-Database-Id": "{database_id}"
                },
                "parameters": {
                    "where": "{'Message':{'$regex':'.*'}}"
                },
                "body": null
            },

            "mappings": []
        }

        ]
    };

    Apperyio.mappings["CommentDetail_queryComment_onsuccess_mapping_0"] = {
        "homeScreen": "CommentDetail",
        "directions": []
    };

    Apperyio.mappings["CommentDetail_updateComment_onbeforesend_mapping_0"] = {
        "homeScreen": "CommentDetail",
        "directions": [

        {
            "from_name": "currentComment",
            "from_type": "LOCAL_STORAGE",

            "to_name": "updateComment",
            "to_type": "SERVICE_REQUEST",

            "to_default": {
                "headers": {
                    "X-Appery-Database-Id": "{database_id}",
                    "Content-Type": "application/json"
                },
                "parameters": {},
                "body": {
                    "acl": {
                        "*": {
                            "write": true,
                            "read": true
                        }
                    }
                }
            },

            "mappings": [

            {

                "source": "$['_id']",
                "target": "$['body']['_id']"

            },

            {

                "source": "$['Message']",
                "target": "$['body']['Message']"

            },

            {

                "source": "$['Author']",
                "target": "$['body']['Author']"

            }

            ]
        }

        ]
    };

    Apperyio.mappings["CommentDetail_updateComment_onsuccess_mapping_0"] = {
        "homeScreen": "CommentDetail",
        "directions": []
    };

    Apperyio.datasources = Apperyio.datasources || {};

    window.deleteComment = Apperyio.datasources.deleteComment = new Apperyio.DataSource(db_Comment_delete, {
        "onBeforeSend": function(jqXHR) {
            Apperyio.processMappingAction(Apperyio.mappings["CommentDetail_deleteComment_onbeforesend_mapping_0"]);
        },
        "onComplete": function(jqXHR, textStatus) { /*TODO Remove item form list */
            /*Navigate back to CommentMaster*/
            Apperyio.navigateTo('CommentMaster', {});;

            Apperyio.refreshScreenFormElements("CommentDetail");
        },
        "onSuccess": function(data) {},
        "onError": function(jqXHR, textStatus, errorThrown) {}
    });

    window.createComment = Apperyio.datasources.createComment = new Apperyio.DataSource(db_Comment_create, {
        "onBeforeSend": function(jqXHR) {
            Apperyio.processMappingAction(Apperyio.mappings["CommentDetail_createComment_onbeforesend_mapping_0"]);
        },
        "onComplete": function(jqXHR, textStatus) {

            Apperyio.refreshScreenFormElements("CommentDetail");
        },
        "onSuccess": function(data) {
            console.log('Display success message in   toast-like message');
            Apperyio.navigateTo('CommentMaster', {});
        },
        "onError": function(jqXHR, textStatus, errorThrown) {
            console.log('Display error message in toast-like message');
        }
    });

    window.queryComment = Apperyio.datasources.queryComment = new Apperyio.DataSource(db_Comment_query, {
        "onBeforeSend": function(jqXHR) {
            Apperyio.processMappingAction(Apperyio.mappings["CommentDetail_queryComment_onbeforesend_mapping_0"]);
        },
        "onComplete": function(jqXHR, textStatus) {

            Apperyio.refreshScreenFormElements("CommentDetail");
        },
        "onSuccess": function(data) {
            Apperyio.processMappingAction(Apperyio.mappings["CommentDetail_queryComment_onsuccess_mapping_0"]);
        },
        "onError": function(jqXHR, textStatus, errorThrown) {}
    });

    window.updateComment = Apperyio.datasources.updateComment = new Apperyio.DataSource(db_Comment_update, {
        "onBeforeSend": function(jqXHR) {
            Apperyio.processMappingAction(Apperyio.mappings["CommentDetail_updateComment_onbeforesend_mapping_0"]);
        },
        "onComplete": function(jqXHR, textStatus) {

            Apperyio.refreshScreenFormElements("CommentDetail");
        },
        "onSuccess": function(data) {
            Apperyio.processMappingAction(Apperyio.mappings["CommentDetail_updateComment_onsuccess_mapping_0"]);
            console.log('Entity updated  successfully');
            Apperyio.navigateTo('CommentMaster', {});
        },
        "onError": function(jqXHR, textStatus, errorThrown) {
            console.log('Update failed  with error');
            console.log(JSON.stringify(textStatus));
        }
    });

    Apperyio.CurrentScreen = 'CommentDetail';
    _.chain(Apperyio.mappings).filter(function(m) {
        return m.homeScreen === Apperyio.CurrentScreen;
    }).each(Apperyio.UIHandler.hideTemplateComponents);

    /*
     * Events and handlers
     */

    // On Load
    var CommentDetail_onLoad = function() {
            CommentDetail_elementsExtraJS();

            CommentDetail_deviceEvents();
            CommentDetail_windowEvents();
            CommentDetail_elementsEvents();
        };

    // screen window events


    function CommentDetail_windowEvents() {

        $('#CommentDetail').bind('pageshow orientationchange', function() {
            var _page = this;
            adjustContentHeightWithPadding(_page);
        });
        $('#CommentDetail').on({
            pageshow: function(event) {
                Apperyio.processMappingAction(Apperyio.mappings["CommentDetail_CommentDetail_onpageshow_mapping_0"]);
            },
        });

    };

    // device events


    function CommentDetail_deviceEvents() {
        document.addEventListener("deviceready", function() {

        });
    };

    // screen elements extra js


    function CommentDetail_elementsExtraJS() {
        // screen (CommentDetail) extra code

        /* NavigationMenu */

        listView = $("#CommentDetail_NavigationMenu");
        theme = listView.attr("data-theme");
        if (typeof theme !== 'undefined') {
            var themeClass = "ui-btn-up-" + theme;
            listItem = $("#CommentDetail_NavigationMenu .ui-li-static");
            $.each(listItem, function(index, value) {
                $(this).addClass(themeClass);
            });
        }

        /* NavigationComment */

    };

    // screen elements handler


    function CommentDetail_elementsEvents() {
        $(document).on("click", "a :input,a a,a fieldset label", function(event) {
            event.stopPropagation();
        });

        $(document).off("click", '#CommentDetail_mobileheader1 [name="showmenue"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    $('[id="CommentDetail_NavigationPanel"]').panel("open");

                }
            },
        }, '#CommentDetail_mobileheader1 [name="showmenue"]');

        $(document).off("click", '#CommentDetail_mobilecontainer1 [name="savebutton"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    Apperyio.processMappingAction(Apperyio.mappings["CommentDetail_savebutton_onclick_mapping_0"]);
                    var currentComment = Apperyio.storage.currentComment.get();

                    if (currentComment['_id'] != undefined && currentComment['_id'] != '') { /*update existing entity*/
                        console.log(' update ');
                        try {
                            updateComment.execute({});
                        } catch (e) {
                            console.error(e);
                            hideSpinner();
                        };

                    } else { /*create  new  entity*/
                        console.log(' create ');
                        try {
                            createComment.execute({});
                        } catch (e) {
                            console.error(e);
                            hideSpinner();
                        };

                    };

                }
            },
        }, '#CommentDetail_mobilecontainer1 [name="savebutton"]');
        $(document).off("click", '#CommentDetail_mobilecontainer1 [name="cancelbutton"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    Apperyio.navigateTo('CommentMaster', {});

                }
            },
        }, '#CommentDetail_mobilecontainer1 [name="cancelbutton"]');

        $(document).off("click", '#CommentDetail_NavigationPanel [name="NavigationComment"]').on({
            click: function(event) {
                if (!$(this).attr('disabled')) {
                    Apperyio.navigateTo('CommentMaster');

                }
            },
        }, '#CommentDetail_NavigationPanel [name="NavigationComment"]');

    };

    $(document).off("pagebeforeshow", "#CommentDetail").on("pagebeforeshow", "#CommentDetail", function(event, ui) {
        Apperyio.CurrentScreen = "CommentDetail";
        _.chain(Apperyio.mappings).filter(function(m) {
            return m.homeScreen === Apperyio.CurrentScreen;
        }).each(Apperyio.UIHandler.hideTemplateComponents);
    });

    CommentDetail_onLoad();
};

$(document).off("pagecreate", "#CommentDetail").on("pagecreate", "#CommentDetail", function(event, ui) {
    Apperyio.processSelectMenu($(this));
    CommentDetail_js();
});